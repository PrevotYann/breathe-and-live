<form class="{{cssClass}} breathe-capacite-sheet" autocomplete="off">
  <header class="sheet-header flexrow">
    <img class="profile-img" src="{{item.img}}" data-edit="img" title="{{item.name}}" />
    <div class="header-fields">
      <h1><input name="name" type="text" value="{{item.name}}" placeholder="Nom de la capacité" /></h1>
      <div class="grid-2col">
        <div>
          <label>Famille</label>
          <select name="system.famille">
            {{#each familleList as |label key|}}
              <option value="{{key}}" {{#if (eq key ../system.famille)}}selected{{/if}}>{{label}}</option>
            {{/each}}
          </select>
        </div>
        <div>
          <label>Résumé court</label>
          <input type="text" name="system.resume" value="{{system.resume}}" placeholder="Résumé / tag…" />
        </div>
      </div>
    </div>
  </header>

  <!-- Onglets -->
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="resume">Description</a>
    <a class="item" data-tab="extrasensorielle">Extrasensorielle</a>
    <a class="item" data-tab="surnaturelle">Surnaturelle</a>
    <a class="item" data-tab="humaine">Humaine</a>
  </nav>

  <section class="sheet-body">
    <!-- Description -->
    <div class="tab" data-group="primary" data-tab="resume">
      <h2>Description / Effet</h2>
      <textarea name="system.effet" rows="5" placeholder="Effet détaillé de la capacité…">{{system.effet}}</textarea>
    </div>

    <!-- Extrasensorielles -->
    <div class="tab" data-group="primary" data-tab="extrasensorielle">
      <h2>Capacité extrasensorielle</h2>
      <div class="grid-3col">
        <div>
          <label>Sens</label>
          <select name="system.sens">
            {{#each sensList as |label key|}}
              <option value="{{key}}" {{#if (eq key ../system.sens)}}selected{{/if}}>{{label}}</option>
            {{/each}}
          </select>
        </div>
        <div>
          <label>Niveau</label>
          <input type="number" name="system.niveau" value="{{system.niveau}}" min="1" max="3" />
        </div>
        <div>
          <label>Bonus Perception (+)</label>
          <input type="number" name="system.bonus.perception" value="{{system.bonus.perception}}" />
        </div>
      </div>
      <div class="grid-2col">
        <div>
          <label>Détection</label>
          <input type="text" name="system.bonus.detection" value="{{system.bonus.detection}}" placeholder="ex: Détecte démons à 9 m / 18 m" />
        </div>
        <div>
          <label>Spécial</label>
          <input type="text" name="system.bonus.special" value="{{system.bonus.special}}" placeholder="ex: prédire action, voir PV ennemis…" />
        </div>
      </div>
      <p class="hint">Niveaux 1→3 comme dans le PDF : +3/+4/+5 Perception, portée 9m/18m, effets spéciaux.</p>
    </div>

    <!-- Surnaturelles -->
    <div class="tab" data-group="primary" data-tab="surnaturelle">
      <h2>Capacité surnaturelle</h2>
      <div class="grid-3col">
        <div>
          <label>Coût (points création)</label>
          <input type="number" name="system.pointsCout" value="{{system.pointsCout}}" />
        </div>
        <div>
          <label>Pré-requis</label>
          <input type="text" name="system.conditions" value="{{system.conditions}}" placeholder="ex: Génie, Démoniste, etc." />
        </div>
        <div>
          <label>Automatiser (expérimental)</label>
          <input type="checkbox" name="system.automatiser" {{checked system.automatiser}} />
        </div>
      </div>

      <h3>Bonus/Modificateurs (liste libre)</h3>
      <div>
        <a class="bonus-add button">+ Ajouter un bonus</a>
      </div>
      <ol class="bonus-list">
        {{#each system.bonusPassifs as |b idx|}}
          <li class="bonus-item" data-idx="{{idx}}">
            <div class="grid-3col">
              <div>
                <label>Clé</label>
                <input class="bonus-field" data-path="cle" value="{{b.cle}}" placeholder="ex: statsBase.force / attributes.ca / statsDerivees.precision" />
              </div>
              <div>
                <label>Valeur</label>
                <input class="bonus-field" data-path="valeur" value="{{b.valeur}}" placeholder="+3 / +2 / x1.5…" />
              </div>
              <div style="display:flex;align-items:flex-end;justify-content:flex-end;">
                <a class="bonus-del"><i class="fas fa-trash"></i></a>
              </div>
            </div>
          </li>
        {{/each}}
      </ol>
      <p class="hint">Exemples :<br>
        • Force physique accrue → <code>statsBase.force:+3</code>, <code>statsDerivees.puissanceBrute:+6</code><br>
        • Intelligence supérieure → <code>jets/intellect:+3 en combat</code> (à gérer en roll macro), <code>statsDerivees.*:+3</code><br>
        • Sang résistant → immunité poisons ≤ rang (note de règle).
      </p>
    </div>

    <!-- Humaines -->
    <div class="tab" data-group="primary" data-tab="humaine">
      <h2>Capacité humaine</h2>
      <div class="grid-2col">
        <div>
          <label>Type</label>
          <select name="system.typeHumaine">
            {{#each typeHumaineList as |label key|}}
              <option value="{{key}}" {{#if (eq key ../system.typeHumaine)}}selected{{/if}}>{{label}}</option>
            {{/each}}
          </select>
        </div>
        <div>
          <label>Note de règle</label>
          <input type="text" name="system.noteRegle" value="{{system.noteRegle}}" placeholder="Ex: Attaque, Utilisation d’objet, Attendre, Sprint…" />
        </div>
      </div>
      <p class="hint">Ces capacités sont communes à toutes les classes (voir PDF : Attaque, Utilisation d’objets, Éviter, etc.).</p>
    </div>
  </section>
</form>
